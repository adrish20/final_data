<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Failure Prediction</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; padding: 20px; border: 1px solid #ccc; }
        button { width: 100%; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>

    <div class="container">
        <h2>Network Failure Prediction</h2>
        <button id="measure-btn" onclick="measureNetworkParams()">Measure Network Parameters</button>
        <div id="network-details"></div>
    </div>

    <script>
        let networkInfo = null;

        // Function to measure network parameters
        async function measureNetworkParams() {
            try {
                // Clear previous results
                document.getElementById('network-details').innerHTML = '';

                // Get network info using Network Information API
                if ('connection' in navigator) {
                    networkInfo = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                    const networkType = getNetworkType();
                    const downlink = networkInfo.downlink || 'unknown';
                    const rtt = networkInfo.rtt || 'unknown';

                    // Display the measured parameters
                    document.getElementById('network-details').innerHTML = `
                        <strong>Network Parameters:</strong><br>
                        Network Type: ${networkType}<br>
                        Downlink: ${downlink} Mbps<br>
                        Latency (RTT): ${rtt} ms<br>
                    `;

                    // Predict network strength
                    const signalStrength = estimateSignalStrength(rtt, downlink);
                    document.getElementById('network-details').innerHTML += `
                        <strong>Estimated Signal Strength:</strong> ${signalStrength} dBm<br>
                    `;
                    
                    // Send data to the backend for prediction
                    await getPrediction(signalStrength, networkType);
                } else {
                    alert('Network Information API not supported in your browser.');
                }
            } catch (error) {
                console.error('Error measuring network parameters:', error);
                alert('Error measuring network parameters: ' + error.message);
            }
        }

        // Get network type
        function getNetworkType() {
            if ('connection' in navigator) {
                return navigator.connection.effectiveType || 'unknown';
            }
            return 'unknown';
        }

        // Estimate signal strength in dBm based on latency and downlink
        function estimateSignalStrength(rtt, downlink) {
            let signalStrength;

            // Simple formula for estimating signal strength based on downlink speed
            if (downlink > 50) {
                signalStrength = -30;  // Excellent
            } else if (downlink > 20) {
                signalStrength = -70;  // Good
            } else if (downlink > 10) {
                signalStrength = -90;  // Fair
            } else {
                signalStrength = -110; // Poor
            }

            // Adjust based on latency (in ms)
            if (rtt > 200) {
                signalStrength -= 10; // Decrease signal strength for higher latency
            } else if (rtt > 100) {
                signalStrength -= 5;  // Slight decrease for moderate latency
            }

            return signalStrength; // Return in dBm
        }

        // Send data to backend for prediction
        async function getPrediction(signalStrength, networkType) {
            const data = {
                network_type: networkType,
                downlink: networkInfo.downlink,
                rtt: networkInfo.rtt,
                signal_strength: signalStrength
            };

            try {
                const response = await fetch('http://localhost:5000/predict', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();
                document.getElementById('network-details').innerHTML += `
                    <strong>Prediction Result:</strong> ${result.prediction}<br>
                `;
                console.log('Prediction result:', result);
            } catch (error) {
                console.error('Error during prediction:', error);
            }
        }
    </script>

</body>
</html>
